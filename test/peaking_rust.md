# `peaking.rs` テスト解説

このドキュメントは `src-tauri/src/peaking.rs` に追加された単体テストについて解説します。

## テスト対象モジュール

`peaking.rs` は、画像のフォーカスピーキング処理（エッジ検出によるピントの可視化）を担当するモジュールです。

## 今回のテスト対象関数

### `downsample_if_needed`

この関数は、処理負荷を軽減するために、巨大な画像を指定された閾値に基づいて縮小（ダウンサンプリング）する役割を持ちます。

## テストケース

`downsample_if_needed` 関数に対して、以下のシナリオを検証するテストが実装されています。

1.  **ダウンサンプリングが不要な場合**
    - 入力画像の幅と高さが両方とも閾値未満の場合、画像が変更されず、スケール値も返されない(`None`)ことを確認します。

2.  **幅が広い画像のダウンサンプリング**
    - 画像の幅が閾値を超えている場合に、正しくダウンサンプリングが実行され、新しいサイズとスケールバック用の値が返されることを確認します。

3.  **高さが高い画像のダウンサンプリング**
    - 画像の高さが閾値を超えている場合に、正しくダウンサンプリングが実行されることを確認します。

4.  **スケールバック計算の検証**
    - ダウンサンプリング後に返されるスケール値を使って、座標を元のサイズに正しく戻せるかを確認します。これにより、計算の正確性を保証します。
