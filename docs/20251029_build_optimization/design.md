# ビルド時間測定と最適化

## 目的

VDI-solidプロジェクトのビルド時間を正確に測定し、ボトルネックを特定して最適化を行う。

## 現状分析

### 現在の設定

**package.json**
- Vite 6.0.3
- TypeScript 5.6.2
- SolidJS 1.9.3
- Tauri 2.x

**vite.config.ts**
既に実装されている最適化:
- Terserによるminify
- console.log/debugger文の削除
- コード分割(tauri-api, vendor-solid)
- ソースマップの無効化

### 測定対象

1. Viteビルド時間
2. Tauriビルド時間
3. 各ビルドフェーズの詳細
   - 依存関係の解決
   - トランスパイル
   - バンドリング
   - Minify
   - Rustコンパイル

## 要件

### 1. ビルド時間測定機能

**測定ツールの導入**
- `vite-plugin-inspect`: Viteプラグインの処理時間を可視化
- `rollup-plugin-visualizer`: バンドルサイズとモジュール構成を可視化
- カスタムプラグイン: 各ビルドフェーズの時間を計測

**測定データの出力**
- ビルド開始/終了時刻
- 各フェーズの所要時間
- バンドルサイズ
- モジュール数
- JSONフォーマットで出力

### 2. 最適化の実施

**優先度A: 高速化が期待できる施策**
1. 依存関係の最適化
   - 未使用の依存関係の削除
   - ビルド時の依存関係解決の最適化

2. TypeScript設定の最適化
   - `skipLibCheck: true`(既に設定済み)
   - インクリメンタルビルドの有効化

3. Viteキャッシュの活用
   - `optimizeDeps.include`による事前バンドル
   - キャッシュディレクトリの設定

**優先度B: 検証が必要な施策**
1. SWCへの移行(現在Terser使用)
2. esbuildへのminify変更
3. 並列処理の最適化

### 3. 継続的な測定

- ビルド時間のトレンド追跡
- CIでの自動測定
- ベースライン比較

## 技術選定

### 測定ツール
- `vite-plugin-inspect`: 開発時のプラグイン分析
- `rollup-plugin-visualizer`: バンドル可視化
- カスタムプラグイン: 時間計測

### 最適化手法
- 依存関係の事前バンドル
- TypeScriptインクリメンタルビルド
- esbuildによる高速minify
- SolidJSコンパイラ最適化

## 実装方針

### フェーズ1: 測定環境の構築
1. 測定プラグインのインストール
2. vite.configの更新
3. 測定スクリプトの追加
4. ベースライン測定の実施

### フェーズ2: ボトルネックの特定
1. 測定データの分析
2. 改善対象の優先順位付け

### フェーズ3: 最適化の実施
1. 優先度Aの施策を実施
2. ビルド時間の再測定
3. 改善効果の検証

### フェーズ4: ドキュメント化
1. 最適化結果のまとめ
2. ベストプラクティスの文書化

## 期待される成果

- ビルド時間の可視化
- ボトルネックの特定
- ビルド時間の短縮(目標: 20-30%削減)
- 継続的な改善のための仕組み

## 制約事項

- 既存の機能に影響を与えない
- 開発体験を損なわない
- プロダクションビルドの品質を維持
