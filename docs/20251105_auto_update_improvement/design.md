# 自動更新機能の改善

## 背景

現在の実装では、手動で更新チェックを行った際に以下の問題がありました:

1. ユーザーが「最新版をチェック」ボタンをクリック
2. 更新が見つかるとボタンが「今すぐアップデート」に変更される
3. **ユーザーが再度ボタンをクリックする必要がある** ← 2段階操作が必要

一方、バックグラウンド更新チェックでは、更新が見つかった時点で確認ダイアログが自動表示され、スムーズな更新が可能でした。

## 要件

手動更新チェックでも、更新が見つかった時点で確認ダイアログを表示し、ユーザーが承認すれば即座にダウンロード・インストールを開始するように改善する。

## 実装方針

### 変更ファイル
- `src/components/SettingsMenu/VersionInfo.tsx`

### 実装内容

1. **Tauri dialogプラグインのインポート**
   - `@tauri-apps/plugin-dialog`から`ask`関数をインポート

2. **handleCheckUpdate関数の修正**
   - 更新が見つかった場合、確認ダイアログを即座に表示
   - ダイアログにはバージョン情報とリリースノートを含める
   - ユーザーが「今すぐアップデート」を選択した場合、即座にダウンロード・インストールを開始
   - エラーハンドリングを追加

### 動作フロー

**修正前**:
```
ボタンクリック → チェック → 更新あり → ボタン変更 → 再度クリック → インストール
```

**修正後**:
```
ボタンクリック → チェック → 更新あり → 確認ダイアログ → 承認 → インストール
```

## 技術詳細

### 確認ダイアログの実装

```typescript
const shouldUpdate = await ask(
  `新しいバージョン ${result.update.version} が利用可能です。${releaseNotes}\n\n今すぐアップデートしますか?`,
  {
    title: "アップデート利用可能",
    kind: "info",
    okLabel: "今すぐアップデート",
    cancelLabel: "後で",
  },
);
```

### エラーハンドリング

インストール処理でエラーが発生した場合:
- コンソールにエラーログを出力
- ユーザーにエラーメッセージを表示
- インストール状態をリセット

## 実装完了後の動作

1. ユーザーが「最新版をチェック」ボタンをクリック
2. 更新チェックを実行
3. 更新が見つかった場合:
   - バージョン情報とリリースノートを含む確認ダイアログを表示
   - ユーザーが「今すぐアップデート」を選択
   - ダウンロード進捗を表示しながらインストール実行
   - 完了後、自動再起動
4. 更新がない場合:
   - 「最新版を使用しています」メッセージを表示
