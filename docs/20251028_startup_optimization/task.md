# 起動速度最適化タスク

## タスク一覧

### 準備作業
- [x] 設計ドキュメント作成
- [x] タスクリスト作成
- [ ] feature/startup-optimizationブランチ作成

### バックエンド最適化

#### Cargo.toml最適化
- [ ] リリースプロファイル設定追加
  - [ ] lto = trueを設定
  - [ ] codegen-units = 1を設定
  - [ ] opt-level = "z"を設定
  - [ ] strip = trueを設定
  - [ ] panic = "abort"を設定
  - [ ] コミット: "add: Cargoリリースプロファイル最適化設定"

#### 依存関係最適化
- [ ] tokioの機能フラグ最適化
  - [ ] features = ["full"]を必要最小限に変更
  - [ ] 必要な機能の洗い出し(rt-multi-thread, macros, sync, fs)
  - [ ] コミット: "add: tokio依存関係の機能フラグ最適化"
- [ ] imageクレートの最適化
  - [ ] 未使用フォーマットの無効化検討
  - [ ] 必要なフォーマットの確認(png, jpeg, gif, webp)
  - [ ] コミット: "add: imageクレートの機能フラグ最適化"

### フロントエンド最適化

#### Viteビルド設定
- [ ] vite.config.tsの最適化
  - [ ] build.rollupOptions.output.manualChunks設定
  - [ ] build.minify = 'terser'設定
  - [ ] build.terserOptions設定
  - [ ] build.chunkSizeWarningLimit調整
  - [ ] コミット: "add: Viteバンドル最適化設定"

#### コンポーネント遅延ロード
- [ ] SettingsMenu遅延ロード実装
  - [ ] lazy()でインポート
  - [ ] Suspenseでラップ
  - [ ] ローディング状態追加
  - [ ] コミット: "add: SettingsMenuの遅延ロード実装"
- [ ] ImageGallery遅延ロード実装
  - [ ] lazy()でインポート
  - [ ] Suspenseでラップ
  - [ ] ローディング状態追加
  - [ ] コミット: "add: ImageGalleryの遅延ロード実装"
- [ ] Footerファイル情報の遅延取得実装
  - [ ] Footer UIは即座に表示
  - [ ] ファイル情報取得を遅延実行
  - [ ] コミット: "add: Footerファイル情報の遅延取得実装"

### 起動フロー最適化

#### アップデートチェック非同期化
- [ ] updateManager呼び出しタイミング変更
  - [ ] show_window後に移動
  - [ ] タイムアウト設定追加
  - [ ] エラーハンドリング強化
  - [ ] コミット: "add: アップデートチェックの完全な非同期化"

#### 初期レンダリング段階化
- [ ] Critical Rendering Path実装
  - [ ] Titlebar + ImageViewer + Footer UIを優先表示
  - [ ] SettingsMenuとImageGalleryを遅延表示
  - [ ] requestIdleCallbackでの遅延レンダリング
  - [ ] コミット: "add: 初期レンダリングの段階的実行"

#### show_windowタイミング最適化
- [ ] 呼び出しタイミング変更
  - [ ] requestAnimationFrameからqueueMicrotaskへ変更
  - [ ] または最小限レンダリング完了後に即座に表示
  - [ ] コミット: "add: show_windowコマンド呼び出しタイミング最適化"

#### システムテーマ取得並列化
- [ ] テーマ取得の非同期化
  - [ ] get_system_themeをウィンドウ表示前に非同期実行
  - [ ] localStorageキャッシュ優先使用
  - [ ] テーマ適用の非同期化
  - [ ] コミット: "add: システムテーマ取得の並列化"

#### 画像フォルダスキャン遅延
- [ ] スキャンタイミング変更
  - [ ] get_folder_imagesをウィンドウ表示後に実行
  - [ ] バックグラウンド実行の実装
  - [ ] ImageGalleryコンポーネントでの遅延呼び出し
  - [ ] コミット: "add: 画像フォルダスキャンの遅延実装"

### 検証とテスト
- [ ] ビルドサイズ比較
  - [ ] 最適化前後のバンドルサイズ計測
  - [ ] バイナリサイズ計測
- [ ] パフォーマンス測定
  - [ ] 起動時間計測
  - [ ] Time to Interactive計測
  - [ ] メモリ使用量確認
- [ ] 動作確認
  - [ ] 各プラットフォームでの起動確認
  - [ ] フルスクリーン引数起動の確認
  - [ ] 画像表示の確認
  - [ ] ギャラリー表示の確認
  - [ ] 設定メニュー表示の確認

### ドキュメント更新
- [ ] CHANGELOGへの追記
- [ ] README更新(必要に応じて)

## 実装順序

1. **準備**: ブランチ作成
2. **バックエンド**: Cargo.toml最適化 → 依存関係最適化
3. **フロントエンド**: Vite設定 → コンポーネント遅延ロード
4. **起動フロー**: show_windowタイミング → テーマ取得並列化 → アップデートチェック → レンダリング段階化 → フォルダスキャン遅延
5. **検証**: テストとパフォーマンス測定

## 各タスクの期待効果

| タスク | 期待効果 |
|--------|----------|
| Cargoリリースプロファイル | バイナリサイズ15-25%削減、起動50-100ms短縮 |
| 依存関係最適化 | バイナリサイズ5-10%削減 |
| Viteバンドル最適化 | バンドルサイズ10-20%削減 |
| コンポーネント遅延ロード | 初期バンドルサイズ30-50%削減、起動100-300ms短縮 |
| アップデート非同期化 | 起動時間100-500ms短縮 |
| レンダリング段階化 | 体感起動速度30-40%向上 |
| show_windowタイミング | 起動時間20-50ms短縮 |
| テーマ取得並列化 | 起動時間10-30ms短縮 |
| フォルダスキャン遅延 | 起動時間50-200ms短縮 |

## 注意事項

- 各実装ごとに小さな単位でコミット
- コミットメッセージは"add: ○○の実装"形式
- Claudeの著名は不要
- ビルド成功を確認してからコミット
- フルスクリーン引数起動時の動作確認必須
