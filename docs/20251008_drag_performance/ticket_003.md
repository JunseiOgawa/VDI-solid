# Ticket #003: パフォーマンステストと動作確認

## メタデータ
- **優先度**: Medium
- **見積**: 0.5時間
- **依存チケット**: #001, #002
- **ステータス**: 未着手

## 目的
実装した最適化が期待通りのパフォーマンス改善をもたらし、既存機能に後退がないことを確認する。

## 対象ファイル

### 変更ファイル
なし（テストのみ）

### 確認ファイル
- `src/components/ImageViewer/index.tsx`

## 影響範囲
- 全体的なアプリケーションのパフォーマンス
- ユーザー体験の向上

## 実装手順

### 1. パフォーマンス測定の準備
ブラウザの開発者ツールを使用:
- Performance タブを開く
- CPU使用率の記録を有効化
- フレームレートの表示を有効化

### 2. ベースライン測定（最適化前の状態と比較）
以下の操作を実施し、結果を記録:
1. 画像をドラッグ（5秒間）
   - フレームレート: 目標60fps以上
   - CPU使用率: 目標値を記録
   - 体感的な滑らかさ
2. ズーム操作（200% → 50% → 100%）
3. 回転操作（0° → 90° → 180° → 270°）

### 3. キャッシュヒット率の確認
コンソールログで以下を確認:
- ドラッグ中のキャッシュヒット率
- キャッシュミスが発生するタイミング（スケール変更時など）
- 不要なキャッシュクリアが発生していないか

### 4. 機能回帰テスト
以下の既存機能が正常に動作することを確認:
1. **ドラッグ操作**
   - [ ] マウスに即座に追従する
   - [ ] 境界を超えない
   - [ ] スムーズに動作する
   
2. **ズーム操作**
   - [ ] マウスホイールで拡大・縮小できる
   - [ ] 境界制約が正しく適用される
   - [ ] スケール変更後のドラッグも正常
   
3. **回転操作**
   - [ ] 回転後も境界制約が正しい
   - [ ] 回転後のドラッグが正常
   
4. **画像切り替え**
   - [ ] D&Dで画像を切り替えられる
   - [ ] 切り替え後も境界制約が正しい
   - [ ] 切り替え後のドラッグが正常
   
5. **スクリーンフィット**
   - [ ] 画像がコンテナに収まる
   - [ ] 実行後も境界制約が正しい
   
6. **リセット**
   - [ ] 位置が中央に戻る
   - [ ] リセット後のドラッグが正常

### 5. エッジケーステスト
1. **高速操作**
   - 高速にドラッグ → ズーム → ドラッグ
   - 画像を高速に連続切り替え
   
2. **コンテナリサイズ**
   - ウィンドウサイズを変更しながらドラッグ
   
3. **複合操作**
   - ドラッグ中にズーム
   - ズーム中に回転
   - 回転中に画像切り替え

### 6. パフォーマンス改善の数値化
最適化前後の比較:
- フレームレート: ___ fps → ___ fps
- CPU使用率: ___ % → ___ %
- `clampToBounds`呼び出し回数: ___ 回/秒 → ___ 回/秒
- 体感的な改善: 5段階評価

## 技術的詳細

### 測定ツール
1. **Chrome DevTools Performance**
   - CPU使用率
   - フレームレート（FPS）
   - JavaScript実行時間
   
2. **Console API**
   - `console.time()` / `console.timeEnd()`
   - カスタムログ出力

### 期待値
- **フレームレート**: 60fps維持（最低でも55fps以上）
- **CPU使用率**: 20-30%削減
- **体感**: マウスに遅延なく追従

### 失敗基準
以下の場合は実装を見直す:
- フレームレートが50fps未満に落ちる
- CPU使用率の改善が10%未満
- 既存機能に不具合が発生

## 完了条件

- [ ] パフォーマンス測定が完了している
- [ ] フレームレートが目標値を達成している
- [ ] CPU使用率が改善している
- [ ] 全ての機能回帰テストがパスしている
- [ ] エッジケーステストで問題が発生しない
- [ ] 測定結果が文書化されている
- [ ] 必要に応じて最適化が調整されている

## テスト項目

### パフォーマンステスト
- [ ] ドラッグ操作のフレームレート測定
- [ ] CPU使用率の測定
- [ ] キャッシュヒット率の確認

### 機能テスト（全て正常動作すること）
- [ ] ドラッグ操作
- [ ] ズーム操作
- [ ] 回転操作
- [ ] 画像切り替え
- [ ] スクリーンフィット
- [ ] リセット

### エッジケーステスト
- [ ] 高速連続操作
- [ ] コンテナリサイズ
- [ ] 複合操作

## 測定結果記録テンプレート

```
## パフォーマンス測定結果

### 環境
- ブラウザ: Chrome/Edge/Firefox
- モニター: 60Hz/120Hz/144Hz
- 画像サイズ: 1920x1080

### 測定値
| 項目 | 最適化前 | 最適化後 | 改善率 |
|------|---------|---------|--------|
| FPS | __ fps | __ fps | __%  |
| CPU使用率 | __% | __% | __%  |
| 呼び出し回数 | __回/秒 | __回/秒 | __%  |

### 体感評価
- 最適化前: [1-5段階]
- 最適化後: [1-5段階]
- コメント: [自由記述]
```

## 参考資料
- Chrome DevTools Performance: https://developer.chrome.com/docs/devtools/performance/
- SolidJS Performance Tips: https://www.solidjs.com/guides/rendering#performance
